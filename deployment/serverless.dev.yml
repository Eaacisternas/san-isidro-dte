service: cw-cl-template-node-dev

plugins:
  - serverless-plugin-log-retention
  - serverless-offline
  - serverless-s3-encryption

provider:
  name: aws
  stage: dev
  runtime: nodejs16.x
  memorySize: 256
  timeout: 30
  versionFunctions: false
  apiGateway:
    restApiId: sqbtyilwv2 # REST API resource ID. Default is generated by the framework
    restApiRootResourceId: ux5cuvogf0 # Root resource, represent as / path

functions:
  main:
    handler: app/src/lambda.handler
    vpc:
      securityGroupIds:
        - sg-0c4e4e55916e5347b
      subnetIds:
        - subnet-0ea26ff639698c90e
        - subnet-035a0a3883c91ef32
    events:
      - http:
          method: ANY
          path: /cw-cl-bff-mobile
      - http:
          method: ANY
          path: '/cw-cl-bff-mobile/{proxy+}'

custom:
  logRetentionInDays: 30
  optimize:
    external: ['swagger-ui-dist']
  serverless-offline:
    httpPort: 4000
    websocketPort: 4001
    lambdaPort: 4002
  s3-encryption:
    buckets:
      MyEncryptedBucket:
        # see: http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/S3.html#putBucketEncryption-property
        # accepted values: none, AES256, aws:kms
        SSEAlgorithm: aws:kms
        KMSMasterKeyID: dde2aca3-e299-4557-ba87-5e10ba6f1921
        # only if SSEAlgorithm is aws:kms

resources:
  Resources:
    MyEncryptedBucket:
      Type: 'AWS::S3::Bucket'
      DeletionPolicy: Retain
